<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="UTF-8">
    <title>One page react app</title>

      <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

      <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
      <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
      <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

  </head>

  <body>

    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div id="root"></div>
        </div>
      </div>
    </div>


    <script type="text/babel">
        class App extends React.Component {
            constructor(props) {
              super(props);
              this.state = 
                {
                  text: '',
                  todos: [
                    {
                      id: 1,
                      name: 'Meeting At Work'
                    },
                    {
                      id: 2,
                      name: 'Make breakfast'
                    },
                    {
                      id: 3,
                      name: 'Food shopping'
                    }
                  ]
                }
            };

            handleTodoAdd(newtodo) {
              var newTodo = {
                id: this.state.todos.length + 1,
                name: newtodo
              }

              this.setState(
                {todos: this.state.todos.concat(newTodo)}
              );
            };

            handleTodoDelete(removetodo) {
              var todos = this.state.todos;
              for(var i=0; i<todos.length; i++){
                if(todos[i].id == removetodo.id){
                  todos.splice(i, 1);
                }
              }
              this.setState(
                {todos: todos}
              )
            };


            render() {
              return(
                <div>
                  {/* If you dont bind(this), then this will refer to TodoForm component in the handleTodoAdd function instead of App component*/}
                  <TodoForm onTodoAdd={this.handleTodoAdd.bind(this)} />
                  <TodoList mytodos={this.state.todos} onDelete={this.handleTodoDelete.bind(this)} />
                </div>
              );
            };
        };
      



        class TodoForm extends React.Component {
            handleChange() {
              console.log('Changing');
            };

            handleSubmit(e) {
              e.preventDefault();
              var mytext = this.refs.texto.value.trim();
              // validation for non-empty text
              if (!mytext) {
                alert('Please enter a todo');
                return;
              }

              // we are passing mytext from TodoForm component(child) to App component(parent)
              this.props.onTodoAdd(mytext);
              // reset the value
              this.refs.texto.value = ''
            };

            render() {
              return(
                <div>
                  <form onSubmit={this.handleSubmit.bind(this)}>
                    <div className="form-group">
                      <label>Todo name</label>
                      <input type="text" ref="texto" className="form-control" onChange={this.handleChange} />
                      {/* No submit button - Press enter to submit */}
                    </div>
                  </form>
                </div>
              );
            };
        };
        



        class TodoList extends React.Component {
            
            onTodoDelete(removetodo) {
              this.props.onDelete(removetodo);
            };

            render() {
              return(
               <ul>
                {
                  this.props.mytodos.map(todo => 
                    {
                      return <li itodo={todo} key={todo.id}>{todo.name} <a href="#" onClick={this.onTodoDelete.bind(this, todo)}>x</a></li>
                    }
                  )
                }
               </ul>
              );
            };
        };


        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

  </body>
</html>